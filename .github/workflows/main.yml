name: Main

on:
  workflow_dispatch:
  schedule:
  - cron: "0 2 * * *"

jobs:
  refresh_ubuntu:
    name: refresh ubuntu tags
    runs-on: ubuntu-latest
    steps:
    - name: 'Clone repository'
      run: 'git clone --filter=blob:none --no-checkout https://github.com/sirdarckcat/ubuntu .'
    - name: 'Re-configure remotes'
      run: 'curl https://raw.githubusercontent.com/sirdarckcat/ubuntu/automation/git_config >> .git/config'
    - name: 'Re-fetch remotes'
      run: 'git remote | grep -v origin | xargs -i sh -c "git fetch {} --tags --filter=blob:none --verbose --progress || echo ERROR {}"'
    - name: 'Push update'
      run: 'git push --tags'
